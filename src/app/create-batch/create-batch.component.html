<div class="main-container">
  <div class="form-card" style="max-width: 750px; position: relative; overflow: hidden;">

    <div class="form-header">
      <h1 class="form-header-title">Create New Batch</h1>
    </div>
    
    <p class="form-header-subtitle">
      Define the schedule, mode, and start date for the new batch.
    </p>

    <!-- Messages -->
    <div *ngIf="errorMessage" class="submission-success-message" style="background-color: #fcebeb; border-color: #e74c3c; color: #c0392b; margin-bottom: 20px;">
        <p class="message-title">Error!</p>
        <p class="message-content">{{ errorMessage }}</p>
    </div>

    <div *ngIf="successMessage" class="submission-success-message" style="margin-bottom: 20px;">
        <p class="message-title">Success!</p>
        <p class="message-content">{{ successMessage }}</p>
    </div>

    <form #batchForm="ngForm" (ngSubmit)="onSubmit(batchForm)" class="batch-form">

      <!-- Row 1: Name & Course -->
      <div class="form-section-group">
        <div class="form-group">
          <label for="batchName" class="input-label">Batch Name</label>
          <input id="batchName" name="batchName" type="text" required minlength="5" [(ngModel)]="batchData.batchName" #batchName="ngModel" class="input-field" placeholder="e.g. Batch B - 2025"/>
          <div *ngIf="batchName.invalid && (batchName.dirty || batchName.touched)" class="error-message">Name must be at least 5 chars.</div>
        </div>

        <div class="form-group">
          <label for="courseId" class="input-label">Select Course</label>
          <select id="courseId" name="courseId" required [(ngModel)]="batchData.courseId" #courseId="ngModel" class="input-field select-field">
            <option [ngValue]="null" disabled>{{ courses.length === 0 ? 'Courses loading...' : '-- Select a Course --' }}</option>
            <option *ngFor="let c of courses" [ngValue]="c.courseid">{{ c.coursename }}</option>
          </select>
          <div *ngIf="courseId.invalid && (courseId.dirty || courseId.touched)" class="error-message">Required.</div>
        </div>
      </div>

      <!-- Row 2: Date, Time, Mode (3 Columns) -->
      <div class="form-section-group three-cols" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
        
        <div class="form-group">
          <label for="startDate" class="input-label">Start Date</label>
          <input id="startDate" name="startDate" type="date" required [(ngModel)]="batchData.startDate" #startDate="ngModel" class="input-field"/>
          <div *ngIf="startDate.invalid && (startDate.dirty || startDate.touched)" class="error-message">Required.</div>
        </div>

        <div class="form-group">
          <label for="timing" class="input-label">Time Schedule</label>
          <input id="timing" name="timing" type="text" required [(ngModel)]="batchData.timing" #timing="ngModel" class="input-field" placeholder="e.g. 10AM - 12PM"/>
           <div *ngIf="timing.invalid && (timing.dirty || timing.touched)" class="error-message">Required.</div>
        </div>

        <div class="form-group">
          <label for="mode" class="input-label">Mode</label>
          <select id="mode" name="mode" required [(ngModel)]="batchData.mode" #mode="ngModel" class="input-field select-field">
            <option *ngFor="let m of modeOptions" [value]="m">{{ m }}</option>
          </select>
        </div>

      </div>

      <div class="submit-button-container">
        <button type="submit" [disabled]="batchForm.invalid || isSubmitting" class="submit-button" [class.enabled]="batchForm.valid && !isSubmitting" [class.disabled]="batchForm.invalid || isSubmitting">
          {{ isSubmitting ? 'Submitting...' : 'Create Batch' }}
        </button>
      </div>
    </form>
  </div>
</div>