<!-- Main Container -->
<div class="main-container">
  <div class="form-card" style="max-width: 550px; position: relative; overflow: hidden;">

    <!-- Header (with Hamburger Menu Button) -->
    <div class="form-header" style="display: flex; justify-content: space-between; align-items: center;">
      <h1 class="form-header-title">
        Create New Batch
      </h1>
      <!-- Hamburger Menu Icon (SVG) -->
      <button 
        type="button" 
        (click)="toggleBatchListPanel()"
        class="submit-button" 
        style="padding: 10px; background-color: #3498db; width: 44px; height: 44px; flex-shrink: 0;"
        [title]="showBatchListPanel ? 'Hide Batch List' : 'Show Batch List'"
      >
        <svg 
          xmlns="http://www.w3.org/2000/svg" 
          viewBox="0 0 24 24" 
          fill="white" 
          width="24px" 
          height="24px"
          style="display: block; margin: 0 auto;"
        >
          <path d="M0 0h24v24H0z" fill="none"/>
          <!-- Menu Icon Path -->
          <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
        </svg>
      </button>
    </div>
    
    <p class="form-header-subtitle">
      Enter the batch name and select a course to link the batch to.
    </p>

    <!-- Error/Success Messages -->
    <div *ngIf="errorMessage" class="submission-success-message" style="background-color: #fcebeb; border-color: #e74c3c; color: #c0392b; margin-bottom: 20px;">
        <p class="message-title">Error!</p>
        <p class="message-content">{{ errorMessage }}</p>
    </div>

    <div *ngIf="successMessage" class="submission-success-message" style="margin-bottom: 20px;">
        <p class="message-title">Success!</p>
        <p class="message-content">{{ successMessage }}</p>
    </div>

    <!-- Form Area - Template Driven Form (TDF) -->
    <form #batchForm="ngForm" (ngSubmit)="onSubmit(batchForm)" class="batch-form">

      <!-- Section 1: Batch Details (Single Column) -->
      <div class="form-section-group single-col">
        
        <!-- Batch Name -->
        <div class="form-group">
          <label for="batchName" class="input-label">Batch Name</label>
          <input
            id="batchName"
            name="batchName"
            type="text"
            required
            minlength="5"
            [(ngModel)]="batchData.batchName"
            #batchName="ngModel"
            class="input-field"
            placeholder="e.g. Batch B - 2025"
          />
          <div *ngIf="batchName.invalid && (batchName.dirty || batchName.touched)" class="error-message">
            <div *ngIf="batchName.errors?.['required']">Batch Name is required.</div>
            <div *ngIf="batchName.errors?.['minlength']">Name must be at least 5 characters long.</div>
          </div>
        </div>

        <!-- Course Selection (Course ID) -->
        <div class="form-group">
          <label for="courseId" class="input-label">Select Course</label>
          <select
            id="courseId"
            name="courseId"
            required
            [(ngModel)]="batchData.courseId"
            #courseId="ngModel"
            class="input-field select-field"
          >
            <!-- Check if courses are loaded, otherwise show loading message -->
            <option [ngValue]="null" disabled>
                {{ courses.length === 0 ? 'Courses loading...' : '-- Select a Course --' }}
            </option>
            
            <!-- Loop through fetched courses and display both ID and Name, but bind only the ID as the value -->
            <option *ngFor="let c of courses" [ngValue]="c.courseid">
                ID {{ c.courseid }}: {{ c.coursename }} 
            </option>
          </select>
          <div *ngIf="courseId.invalid && (courseId.dirty || courseId.touched)" class="error-message">
            Course selection is required.
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="submit-button-container">
        <button
          type="submit"
          [disabled]="batchForm.invalid || isSubmitting"
          class="submit-button"
          [class.enabled]="batchForm.valid && !isSubmitting"
          [class.disabled]="batchForm.invalid || isSubmitting"
        >
          {{ isSubmitting ? 'Submitting...' : 'Create Batch' }}
        </button>
      </div>
    </form>

  </div>
</div>

<!-- Side Panel for Batch List -->
<div 
  class="course-list-panel" 
  [class.open]="showBatchListPanel"
>
  <!-- Close Button -->
  <button 
    type="button" 
    (click)="toggleBatchListPanel()" 
    style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #34495e;"
  >
    &times;
  </button>
  
  <h2 style="font-size: 1.5rem; font-weight: 700; color: #34495e; margin-bottom: 20px; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px;">
    Manage Batches by Course
  </h2>

  <!-- Course Filter Select -->
  <div class="form-group" style="margin-bottom: 20px;">
    <label for="listCourseId" class="input-label">Filter by Course</label>
    <select
      id="listCourseId"
      name="listCourseId"
      required
      [ngModel]="selectedCourseIdForList"
      (change)="onCourseFilterChange($event)"
      class="input-field select-field"
    >
      <option [ngValue]="null" disabled>
        {{ courses.length === 0 ? 'Courses loading...' : '-- Select a Course --' }}
      </option>
      
      <option *ngFor="let c of courses" [ngValue]="c.courseid">
          ID {{ c.courseid }}: {{ c.coursename }} 
      </option>
    </select>
  </div>


  <!-- List Loading/Error State -->
  <div *ngIf="isListLoading" style="text-align: center; color: #7f8c8d; padding: 20px;">
    <p>Loading batches...</p>
  </div>

  <div *ngIf="listErrorMessage && !isListLoading" class="error-message" style="color: #e74c3c; padding: 10px; border: 1px dashed #e74c3c; border-radius: 8px; margin-top: 15px;">
    {{ listErrorMessage }}
  </div>
  
  <!-- Batch List -->
  <div *ngIf="batches.length > 0 && !isListLoading" class="batch-list">
    <div 
      *ngFor="let batch of batches" 
      style="
        background-color: white; 
        border: 1px solid #ecf0f1; 
        border-radius: 8px; 
        padding: 15px; 
        margin-bottom: 15px; 
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      "
    >
      <div style="font-weight: 700; color: #34495e; font-size: 1.1rem; margin-bottom: 5px;">
        {{ batch.batchName }} 
        <span style="float: right; font-size: 0.9rem; color: #7f8c8d;">ID: {{ batch.batchId }}</span>
      </div>
      <p style="font-size: 0.9rem; margin: 0 0 10px 0;">
        Status: 
        <span 
          [style.color]="batch.is_active ? '#2ecc71' : '#e74c3c'" 
          style="font-weight: 600;"
        >
          {{ batch.is_active ? 'Active' : 'Deactivated' }}
        </span>
      </p>
      
      <!-- Actions -->
      <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button 
          type="button" 
          (click)="toggleBatchStatus(batch)"
          class="submit-button" 
          [style.background-color]="batch.is_active ? '#e74c3c' : '#2ecc71'"
          style="flex: 1; padding: 8px; color: white; font-size: 0.9rem;"
        >
          {{ batch.is_active ? 'Deactivate' : 'Activate' }}
        </button>
      </div>
    </div>
  </div>

</div>

<!-- Panel Overlay for better UX -->
<div 
  class="course-list-overlay" 
  [class.open]="showBatchListPanel"
  (click)="toggleBatchListPanel()"
></div>
