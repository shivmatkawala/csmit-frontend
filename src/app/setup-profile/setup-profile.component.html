<div class="setup-container">
    <div class="form-card">
        <!-- Stepper -->
        <div class="stepper">
            <div *ngFor="let s of steps" class="step" [class.active]="currentStep() >= s.id">
                <div class="step-circle">{{ s.id }}</div>
                <span class="step-label">{{ s.name }}</span>
            </div>
        </div>

        <form [formGroup]="resumeForm" (ngSubmit)="onSubmit()">
            
            <!-- Step 1: Personal -->
            <div *ngIf="currentStep() === 1" class="animate-fade">
                <h2 class="section-title">Personal Details</h2>
                <div class="grid-2">
                    <div class="input-box">
                        <label>Full Name *</label>
                        <input type="text" formControlName="fullName" placeholder="Aarav Sharma">
                        <div class="error" *ngIf="resumeForm.get('fullName')?.touched && resumeForm.get('fullName')?.invalid">
                            <span *ngIf="resumeForm.get('fullName')?.errors?.['required']">Name is mandatory.</span>
                            <span *ngIf="resumeForm.get('fullName')?.errors?.['minlength']">Minimum 3 characters required.</span>
                        </div>
                    </div>
                    <div class="input-box">
                        <label>Date of Birth *</label>
                        <input type="date" formControlName="dob">
                        <div class="error" *ngIf="resumeForm.get('dob')?.touched && resumeForm.get('dob')?.invalid">DOB is required.</div>
                    </div>
                </div>
                <div class="grid-2">
                    <div class="input-box">
                        <label>Email Address *</label>
                        <input type="email" formControlName="email" placeholder="example@email.com">
                        <div class="error" *ngIf="resumeForm.get('email')?.touched && resumeForm.get('email')?.invalid">
                            <span *ngIf="resumeForm.get('email')?.errors?.['required']">Email is required.</span>
                            <span *ngIf="resumeForm.get('email')?.errors?.['email']">Invalid email format.</span>
                        </div>
                    </div>
                    <div class="input-box">
                        <label>Phone Number *</label>
                        <input type="text" formControlName="phone" placeholder="9876543210">
                        <div class="error" *ngIf="resumeForm.get('phone')?.touched && resumeForm.get('phone')?.invalid">10-15 digits required.</div>
                    </div>
                </div>
                <div class="input-box">
                    <label>LinkedIn Profile URL *</label>
                    <input type="url" formControlName="linkedin" placeholder="https://linkedin.com/in/username">
                    <div class="error" *ngIf="resumeForm.get('linkedin')?.touched && resumeForm.get('linkedin')?.invalid">Valid LinkedIn URL required.</div>
                </div>
                <div class="input-box">
                    <label>GitHub/Portfolio URL</label>
                    <input type="url" formControlName="portfolio" placeholder="https://github.com/username">
                    <div class="error" *ngIf="resumeForm.get('portfolio')?.touched && resumeForm.get('portfolio')?.invalid">Valid GitHub URL required.</div>
                </div>
                <div class="input-box">
                    <label>Current Address (City, Country) *</label>
                    <input type="text" formControlName="address" placeholder="Mumbai, India">
                    <div class="error" *ngIf="resumeForm.get('address')?.touched && resumeForm.get('address')?.invalid">Address is required.</div>
                </div>
            </div>

            <!-- Step 2: Education -->
            <div *ngIf="currentStep() === 2" class="animate-fade">
                <h2 class="section-title">Education History</h2>
                <div formArrayName="education">
                    <div *ngFor="let edu of educationArr.controls; let i=index" [formGroupName]="i" class="dynamic-item">
                        <div class="grid-2">
                            <div class="input-box">
                                <input formControlName="degree" placeholder="Degree (e.g. B.Tech CS)">
                                <div class="error" *ngIf="edu.get('degree')?.touched && edu.get('degree')?.invalid">Degree required.</div>
                            </div>
                            <div class="input-box">
                                <input formControlName="institution" placeholder="University/College">
                                <div class="error" *ngIf="edu.get('institution')?.touched && edu.get('institution')?.invalid">Institution required.</div>
                            </div>
                        </div>
                        <div class="grid-3">
                            <input type="month" formControlName="startDate">
                            <input type="month" formControlName="endDate" [disabled]="edu.get('isCurrent')?.value">
                            <input formControlName="grade" placeholder="Grade/CGPA">
                        </div>
                        <label class="check-box">
                            <input type="checkbox" formControlName="isCurrent"> Currently Studying
                        </label>
                    </div>
                </div>
                <button type="button" class="btn-add" (click)="addEducation()">+ Add Another Degree</button>
            </div>

            <!-- Steps 3, 4, 5 (Experience, Skills, Projects) following similar inline error patterns -->
            <div *ngIf="currentStep() === 3" class="animate-fade">
                <h2 class="section-title">Work Experience</h2>
                <div class="exp-toggle">
                    <label *ngFor="let level of ['Fresher', 'Intern', 'Experienced']">
                        <input type="radio" formControlName="experienceType" [value]="level"> {{level}}
                    </label>
                </div>
                <div formArrayName="experience" *ngIf="resumeForm.get('experienceType')?.value !== 'Fresher'">
                    <div *ngFor="let exp of experienceArr.controls; let i=index" [formGroupName]="i" class="dynamic-item">
                        <div class="grid-2">
                            <div class="input-box">
                                <input formControlName="title" placeholder="Job Title">
                                <div class="error" *ngIf="exp.get('title')?.touched && exp.get('title')?.invalid">Title is required.</div>
                            </div>
                            <div class="input-box">
                                <input formControlName="company" placeholder="Company Name">
                                <div class="error" *ngIf="exp.get('company')?.touched && exp.get('company')?.invalid">Company is required.</div>
                            </div>
                        </div>
                        <textarea formControlName="description" placeholder="Project details... (Min 20 chars)"></textarea>
                    </div>
                    <button type="button" class="btn-add" (click)="addExperience()">+ Add Experience</button>
                </div>
            </div>

            <div *ngIf="currentStep() === 4" class="animate-fade">
                <h2 class="section-title">Core Competencies</h2>
                <div formArrayName="skills" class="skills-grid">
                    <div *ngFor="let s of skillsArr.controls; let i=index" [formGroupName]="i" class="skill-row dynamic-item">
                        <div class="grid-2">
                            <div class="input-box">
                                <input formControlName="name" placeholder="Skill Name">
                                <div class="error" *ngIf="s.get('name')?.touched && s.get('name')?.invalid">Skill name required.</div>
                            </div>
                            <div class="input-box">
                                <select formControlName="level">
                                    <option value="">Select Level</option>
                                    <option *ngFor="let p of proficiencyList()" [value]="p.levelName">{{p.levelName}}</option>
                                </select>
                                <div class="error" *ngIf="s.get('level')?.touched && s.get('level')?.invalid">Select level.</div>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-add" (click)="addSkill()">+ Add Skill</button>
            </div>

            <div *ngIf="currentStep() === 5" class="animate-fade">
                <h2 class="section-title">Key Projects</h2>
                <div formArrayName="projects">
                    <div *ngFor="let p of projectsArr.controls; let i=index" [formGroupName]="i" class="dynamic-item">
                        <div class="input-box">
                            <input formControlName="title" placeholder="Project Name">
                            <div class="error" *ngIf="p.get('title')?.touched && p.get('title')?.invalid">Project title required.</div>
                        </div>
                        <input formControlName="techUsed" placeholder="Technologies used (Comma separated)">
                        <textarea formControlName="description" placeholder="Detail description..."></textarea>
                    </div>
                </div>
                <button type="button" class="btn-add" (click)="addProject()">+ Add Project</button>
            </div>

            <div class="form-footer">
                <button type="button" class="btn btn-prev" (click)="prevStep()" *ngIf="currentStep() > 1">Back</button>
                <button type="button" class="btn btn-next" (click)="nextStep()" *ngIf="currentStep() < totalSteps">Next Step</button>
                <button type="submit" class="btn btn-submit" *ngIf="currentStep() === totalSteps" [disabled]="isLoading()">
                    {{ isLoading() ? 'Saving Profile...' : 'Complete Setup' }}
                </button>
            </div>
        </form>
    </div>
</div>