:host {
    /* Refined Color Palette */
    --primary: #0f172a;       /* Deep Navy */
    --primary-light: #1e293b;
    --accent: #3b82f6;        /* Bright Blue */
    --accent-hover: #2563eb;
    --accent-light: #eff6ff;
    --success: #10b981;       /* Emerald */
    --success-dark: #059669;
    --danger: #ef4444;        /* Red */
    --danger-dark: #dc2626;
    --warning: #f59e0b;       /* Amber */
    --bg: #f1f5f9;            /* Slate-100 */
    --card-bg: #ffffff;
    --border: #cbd5e1;
    --text-main: #334155;
    --text-muted: #64748b;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --radius: 12px;
}

/* Global Reset & Container */
.exam-container {
    height: 100vh; /* Fixed height for app-like feel */
    background-color: var(--bg);
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    color: var(--text-main);
    display: flex;
    flex-direction: column;
    overflow: hidden; /* Prevent body scroll, use internal scrolls */
}

/* =========================================
   1. Header Design
   ========================================= */
.main-header {
    background: var(--primary);
    color: white;
    padding: 0.75rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: var(--shadow-md);
    height: 70px;
    box-sizing: border-box;
    flex-shrink: 0; /* Prevent header from shrinking */
}

.brand-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    max-width: 60%;
}

.logo-placeholder { 
    background: rgba(255,255,255,0.1);
    min-width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    font-size: 1.2rem;
    backdrop-filter: blur(4px);
}

.exam-meta {
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.exam-meta h1 { 
    margin: 0; 
    font-size: 1.1rem; 
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.exam-meta span { 
    font-size: 0.75rem; 
    opacity: 0.8; 
    font-weight: 400;
}

/* Timer Section */
.timer-card {
    background: rgba(255,255,255,0.1);
    padding: 0.5rem 1.25rem;
    border-radius: 50px;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    border: 1px solid rgba(255,255,255,0.2);
    transition: all 0.3s ease;
}

.timer-val {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    line-height: 1;
}

.timer-val .label { font-size: 0.65rem; opacity: 0.8; text-transform: uppercase; letter-spacing: 0.5px; }
.timer-val .value { font-size: 1.2rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; }

.danger-timer { 
    background: rgba(239, 68, 68, 0.15); 
    border-color: #fca5a5; 
    color: #fecaca;
    animation: pulse 1s infinite alternate;
}

@keyframes pulse {
    from { box-shadow: 0 0 5px rgba(239, 68, 68, 0.2); }
    to { box-shadow: 0 0 15px rgba(239, 68, 68, 0.6); }
}

/* =========================================
   2. Main Layout (Body)
   ========================================= */
.exam-body {
    display: flex;
    padding: 1.5rem;
    gap: 1.5rem;
    flex: 1;
    max-width: 1440px;
    margin: 0 auto;
    width: 100%;
    box-sizing: border-box;
    align-items: flex-start;
    overflow-y: auto; /* Enable scrolling for the body content */
}

/* Left Side: Question Area */
.question-canvas { 
    flex: 1; 
    display: flex; 
    flex-direction: column;
    min-width: 0;
}

.question-wrapper {
    background: var(--card-bg);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    box-shadow: var(--shadow-sm);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: box-shadow 0.3s ease;
}

.question-wrapper:hover { box-shadow: var(--shadow-md); }

/* Header of Question Card */
.q-header {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f8fafc;
}

.q-index { 
    color: var(--accent); 
    font-weight: 700;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.q-points {
    background: var(--accent-light);
    color: var(--accent);
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 600;
    border: 1px solid rgba(59, 130, 246, 0.2);
}

/* Content Area */
.q-content { 
    padding: 2rem; 
    flex: 1; 
    overflow-y: auto;   /* Scroll ONLY the content area */
    max-height: 60vh;   /* Limit height so footer stays visible */
}

.q-text { 
    font-size: 1.1rem; 
    line-height: 1.6; 
    margin-bottom: 2rem;
    font-weight: 500;
    color: var(--primary-light);
    word-wrap: break-word;
}

/* =========================================
   3. Inputs & Options
   ========================================= */

/* MCQ Grid */
.mcq-grid { display: grid; gap: 1rem; }

.option-card {
    border: 1px solid var(--border);
    padding: 1rem 1.25rem;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 1rem;
    background: white;
    position: relative;
    overflow: hidden;
}

.option-card:hover { 
    border-color: var(--accent); 
    background-color: #f8fafc;
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
}

.option-card.selected { 
    border-color: var(--accent); 
    background-color: var(--accent-light);
    box-shadow: 0 0 0 1px var(--accent);
}

/* Custom Radio Button */
.radio-custom {
    width: 20px; 
    height: 20px;
    border: 2px solid #94a3b8;
    border-radius: 50%;
    flex-shrink: 0;
    position: relative;
    transition: border-color 0.2s;
}

.option-card.selected .radio-custom { border-color: var(--accent); }
.option-card.selected .radio-custom::after {
    content: '';
    position: absolute;
    width: 10px; height: 10px;
    background: var(--accent);
    border-radius: 50%;
    top: 50%; left: 50%; transform: translate(-50%, -50%);
    animation: scaleIn 0.2s ease;
}

@keyframes scaleIn { from { transform: translate(-50%, -50%) scale(0); } to { transform: translate(-50%, -50%) scale(1); } }

/* Text Areas */
.descriptive-box textarea {
    width: 100%;
    box-sizing: border-box;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem;
    font-size: 1rem;
    transition: border 0.2s, box-shadow 0.2s;
    outline: none;
    resize: vertical;
}

.descriptive-box textarea:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-light);
}

/* --- CODING INTERFACE STYLES (Fixed Height) --- */
.coding-interface {
    display: flex;
    flex-direction: column;
    height: 650px; /* Fixed height is mandatory for Monaco */
    min-height: 500px;
    background-color: #1e1e1e;
    color: #cccccc;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
    border-radius: 8px;
    border: 1px solid #333;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}

.editor-header-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 10px;
    height: 40px;
    background-color: #252526;
    border-bottom: 1px solid #1e1e1e;
    flex-shrink: 0;
}

.left-controls {
    display: flex;
    align-items: center;
    gap: 8px;
}

.file-icon {
    font-size: 14px;
    color: #61dafb;
}

.lang-select {
    background: #3c3c3c;
    color: #ffffff;
    border: 1px solid #555;
    font-size: 13px;
    outline: none;
    cursor: pointer;
    font-weight: 500;
    padding: 2px 5px;
    border-radius: 4px;
}

.lang-select:hover { border-color: #888; }
.lang-select option { background-color: #252526; }

.run-btn {
    background: transparent;
    border: none;
    color: #2e8b57;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 4px 10px;
    border-radius: 4px;
    transition: all 0.2s;
    font-size: 0.9rem;
    font-weight: 600;
}

.run-btn:hover {
    background-color: rgba(255, 255, 255, 0.1);
    color: #35a366;
}

/* This wrapper MUST have flex-grow to fill space */
.editor-area-wrapper {
    flex: 1;
    position: relative;
    overflow: hidden;
    background-color: #1e1e1e;
    display: flex;
    flex-direction: column;
}

/* FALLBACK TEXTAREA STYLING */
.fallback-textarea {
    width: 100%;
    height: 100%;
    background-color: #1e1e1e;
    color: #d4d4d4;
    border: none;
    padding: 1rem;
    font-family: 'Consolas', monospace;
    font-size: 1rem;
    resize: none;
    outline: none;
}

.editor-loader {
    position: absolute; 
    top: 50%; 
    left: 50%; 
    transform: translate(-50%, -50%); 
    color: #ccc;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* The actual monaco component needs specific height/width */
.monaco-component {
    flex: 1;
    height: 100%;
    width: 100%;
    display: block;
}

.terminal-box {
    height: 150px; /* Fixed height for terminal */
    background-color: #1e1e1e;
    border-top: 1px solid #414141;
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
}

.terminal-header {
    display: flex;
    gap: 20px;
    padding: 8px 15px;
    background-color: #1e1e1e;
    border-bottom: 1px solid #2b2b2b;
    font-size: 11px;
    font-weight: bold;
    text-transform: uppercase;
}

.tab.active {
    color: #cccccc;
    border-bottom: 1px solid #cccccc;
    padding-bottom: 2px;
}

.terminal-content {
    flex: 1;
    padding: 10px 15px;
    overflow-y: auto;
    font-family: 'Consolas', 'Courier New', monospace;
    font-size: 13px;
    color: #e0e0e0;
}

.placeholder {
    color: #666;
    font-style: italic;
}

/* =========================================
   4. Footer Navigation
   ========================================= */
.q-footer {
    padding: 1.25rem 1.5rem;
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    background-color: #f8fafc;
    flex-wrap: wrap;
    gap: 1rem;
    z-index: 10;
}

.spacer { flex: 1; }

.btn-nav {
    padding: 0.6rem 1.25rem;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: white;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.9rem;
    display: flex; align-items: center; gap: 0.5rem;
    transition: all 0.2s;
    color: var(--text-main);
}

.btn-nav:hover:not(:disabled) { background-color: #f1f5f9; }
.btn-nav:disabled { opacity: 0.5; cursor: not-allowed; }

.btn-nav.primary { background: var(--accent); color: white; border-color: var(--accent); }
.btn-nav.primary:hover { background: var(--accent-hover); }

.btn-nav.submit { background: var(--success); color: white; border-color: var(--success); }
.btn-nav.submit:hover { background: var(--success-dark); }

/* =========================================
   5. Sidebar Palette
   ========================================= */
.exam-sidebar { 
    width: 320px; 
    display: flex; 
    flex-direction: column; 
    gap: 1.5rem;
    flex-shrink: 0;
}

.sidebar-card {
    background: var(--card-bg);
    border-radius: var(--radius);
    padding: 1.25rem;
    border: 1px solid var(--border);
    box-shadow: var(--shadow-sm);
}

.sidebar-card h3 { 
    font-size: 0.8rem; 
    text-transform: uppercase; 
    color: var(--text-muted); 
    margin: 0 0 1rem 0;
    font-weight: 700;
    letter-spacing: 0.5px;
}

.palette-grid { 
    display: grid; 
    grid-template-columns: repeat(5, 1fr); 
    gap: 0.5rem; 
}

.palette-grid button {
    aspect-ratio: 1;
    border: 1px solid var(--border);
    background: white;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    color: var(--text-muted);
}

.palette-grid button:hover { border-color: var(--accent); color: var(--accent); }
.palette-grid button.active { border: 2px solid var(--accent); color: var(--accent); background: var(--accent-light); transform: scale(1.05); }
.palette-grid button.answered { background: var(--success); color: white; border-color: var(--success); }

.stat-item {
    display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem; font-size: 0.9rem; color: var(--text-main);
}
.stat-item .lbl-group { display: flex; align-items: center; gap: 0.75rem; }
.dot { width: 12px; height: 12px; border-radius: 50%; }
.dot.answered { background: var(--success); }
.dot.unanswered { background: #e2e8f0; border: 1px solid #cbd5e1; }
.stat-item .val { font-weight: 700; }

/* =========================================
   6. Security Warning Modal
   ========================================= */
.security-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(15, 23, 42, 0.8);
    backdrop-filter: blur(8px);
    z-index: 9999; 
    display: flex; align-items: center; justify-content: center; 
    padding: 1.5rem; box-sizing: border-box;
}

.warning-box {
    background: white; padding: 2.5rem; border-radius: 20px; text-align: center; 
    max-width: 450px; width: 100%;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
}

@keyframes shake {
  10%, 90% { transform: translate3d(-1px, 0, 0); }
  20%, 80% { transform: translate3d(2px, 0, 0); }
  30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
  40%, 60% { transform: translate3d(4px, 0, 0); }
}

.warning-box i { font-size: 3.5rem; color: var(--danger); margin-bottom: 1rem; }
.warning-box h2 { color: var(--primary); margin: 0 0 0.5rem 0; font-size: 1.5rem; }
.warning-box p { color: var(--text-muted); line-height: 1.5; margin-bottom: 1.5rem; }
.warning-count { background: #fee2e2; color: #991b1b; padding: 0.5rem 1rem; border-radius: 50px; font-weight: 700; font-size: 0.9rem; display: inline-block; margin-bottom: 1.5rem; }

.btn-warning-close {
    background-color: var(--danger); color: white; border: none; padding: 0.9rem 2.5rem; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; width: 100%; box-shadow: 0 4px 6px -1px rgba(239, 68, 68, 0.3);
}
.btn-warning-close:hover { background-color: var(--danger-dark); transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(239, 68, 68, 0.4); }

/* =========================================
   7. Loaders & Result (UPDATED)
   ========================================= */
.loader {
    display: flex; flex-direction: column; align-items: center; justify-content: center; height: 300px; color: var(--accent); gap: 1rem;
}
.loader i { font-size: 2.5rem; }

/* FIXED RESULT SCROLLING */
.result-view {
    display: block; /* Ensure block layout for simple scroll */
    padding: 2rem 1rem;
    width: 100%;
    overflow-y: auto; 
    height: calc(100vh - 70px); /* Fill remaining height */
    box-sizing: border-box;
}

.result-container {
    max-width: 800px;
    width: 100%;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 2rem;
    padding-bottom: 3rem; /* Extra space at bottom */
}

.result-card {
    background: white;
    padding: 3rem 2rem;
    border-radius: 24px;
    text-align: center;
    border: 1px solid var(--border);
    box-shadow: var(--shadow-lg);
}

.analysis-section {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.analysis-section h3 {
    text-align: center;
    color: var(--primary);
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    border-bottom: 2px solid var(--accent);
    display: inline-block;
    padding-bottom: 0.5rem;
    align-self: center;
}

.analysis-card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    transition: transform 0.2s;
}

.analysis-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

.ans-header {
    background: #f8fafc;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.q-num { font-weight: 700; color: var(--primary); }

.score-badge {
    font-size: 0.85rem;
    font-weight: 600;
    padding: 0.25rem 0.75rem;
    border-radius: 50px;
}

.score-badge.full-marks { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
.score-badge.partial { background: #fef9c3; color: #854d0e; border: 1px solid #fde047; }
.score-badge.zero { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }

.ans-body { padding: 1.5rem; }

.q-text-result {
    font-weight: 600;
    font-size: 1.05rem;
    margin-bottom: 1.5rem;
    color: var(--primary);
}

.student-response {
    margin-bottom: 1.5rem;
    background: #f1f5f9;
    padding: 1rem;
    border-radius: 8px;
    border-left: 4px solid var(--text-muted);
}

/* Specific style for displaying code result in feedback */
.response-box.code-response {
    font-family: 'Consolas', 'Monaco', monospace;
    background-color: #1e1e1e;
    color: #d4d4d4;
    padding: 1rem;
    border-radius: 6px;
}

.student-response .label {
    display: block;
    font-size: 0.75rem;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
    font-weight: 700;
}

.student-response .response-box {
    font-family: 'Inter', sans-serif;
    color: var(--text-main);
    white-space: pre-wrap;
}

.ai-feedback-box {
    background: #eff6ff; /* Light Blue */
    border: 1px solid #bfdbfe;
    border-radius: 12px;
    padding: 1.25rem;
}

.feedback-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--accent);
    font-weight: 700;
    margin-bottom: 0.75rem;
    font-size: 0.9rem;
    text-transform: uppercase;
}

.ai-feedback-box p {
    margin: 0;
    line-height: 1.6;
    color: #1e3a8a; /* Dark Blue Text */
    font-size: 0.95rem;
}

/* =========================================
   8. Mobile Responsiveness
   ========================================= */
@media (max-width: 1024px) {
    .exam-body { flex-direction: column; padding: 1rem; }
    .exam-sidebar { width: 100%; order: 2; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .question-canvas { order: 1; margin-bottom: 1rem; width: 100%; }
    .palette-grid { grid-template-columns: repeat(10, 1fr); }
    .q-content { max-height: none; } 
    /* Adjust code editor height on mobile */
    .coding-interface { height: 450px; }
}

@media (max-width: 768px) {
    .main-header { padding: 0.5rem 1rem; height: 60px; }
    .logo-placeholder { width: 32px; height: 32px; font-size: 1rem; }
    .exam-meta h1 { font-size: 0.95rem; max-width: 150px; }
    .timer-card { padding: 0.3rem 0.8rem; }
    .timer-val .label { display: none; }
    .timer-val .value { font-size: 1rem; }
    .exam-sidebar { display: flex; flex-direction: column; }
    .q-header { padding: 0.75rem 1rem; flex-direction: column; gap: 0.5rem; align-items: flex-start; }
    .q-points { align-self: flex-start; }
    .q-content { padding: 1.25rem 1rem; }
    .q-text { font-size: 1rem; margin-bottom: 1.5rem; }
    .q-footer { flex-direction: column-reverse; gap: 0.75rem; }
    .btn-nav { width: 100%; justify-content: center; padding: 0.8rem; }
    .spacer { display: none; }
    .palette-grid { grid-template-columns: repeat(6, 1fr); }
    
    .result-card { padding: 2rem 1.5rem; }
}

@media (max-width: 400px) {
    .palette-grid { grid-template-columns: repeat(5, 1fr); }
    .option-card { padding: 0.8rem; }
}