<div class="batch-management-container">
  <div *ngIf="loading" class="loader-overlay"><div class="premium-spinner"></div></div>

  <div class="header-section">
    <div class="title-group">
      <h1 *ngIf="!selectedBatch"><i class="fas fa-layer-group"></i> My Assigned Batches</h1>
      <h1 *ngIf="selectedBatch">
        <span class="breadcrumb-link" (click)="goBackToList()">Batches</span> 
        <i class="fas fa-chevron-right separator"></i> {{ selectedBatch.batchName || selectedBatch.batch_name }}
      </h1>
      <p class="subtitle">Real-time batch overview and curriculum management.</p>
    </div>
    <button class="btn-back-home" (click)="goHome()" *ngIf="!selectedBatch">
      <i class="fas fa-th-large"></i> Dashboard
    </button>
  </div>

  <!-- Real-time Batch Grid -->
  <div class="batch-grid" *ngIf="!selectedBatch && batches.length > 0">
    <div class="batch-card" *ngFor="let batch of batches">
      <div class="card-content">
        <div style="display: flex; justify-content: space-between; align-items: start;">
           <!-- Fix: Using batchName as seen in API response -->
           <h3>{{ batch.batchName || batch.batch_name }}</h3>
           <span class="status-badge" 
                 [style.background]="batch.is_active ? '#ecfdf5' : '#fef2f2'" 
                 [style.color]="batch.is_active ? '#10b981' : '#ef4444'" 
                 style="padding: 4px 8px; font-size: 10px; border-radius: 6px;">
             {{ batch.is_active ? 'Active' : 'Inactive' }}
           </span>
        </div>
        
        <!-- Timing & Mode Section -->
        <div class="course-meta">
          <i class="fas fa-clock"></i> 
          <span>{{ batch.timing || 'No timing set' }}</span>
        </div>
        <div class="course-meta">
          <i class="fas fa-laptop-house"></i> 
          <span>{{ batch.mode || 'Online' }}</span>
        </div>
        
        <div class="card-action" style="margin-top: 20px;">
          <button class="btn-open" (click)="viewBatchDetails(batch)">
            View Modules <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && batches.length === 0 && !selectedBatch" class="no-data" style="text-align: center; padding: 50px;">
    <i class="fas fa-folder-open" style="font-size: 50px; color: #cbd5e1; margin-bottom: 15px;"></i>
    <p style="color: #94a3b8;">No batches assigned to you yet.</p>
  </div>

  <!-- Simple Detail View -->
  <div class="batch-detail-view" *ngIf="selectedBatch">
    <div class="modules-container" style="grid-column: 1 / -1;">
      <h3><i class="fas fa-stream"></i> Curriculum for {{ selectedBatch.batchName || selectedBatch.batch_name }}</h3>
      <div class="subject-list">
        <div class="subject-item" *ngFor="let s of selectedBatch.subjects; let i = index">
          <div class="subject-count">{{ i + 1 }}</div>
          <div class="subject-info">
            <h4>{{ s.subjectname }}</h4>
            <p>Training Modules & Resources</p>
          </div>
          <i class="fas fa-check-circle" style="color: #cbd5e1;"></i>
        </div>
      </div>
    </div>
  </div>
</div>