<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<body>
  <!-- Main container -->
  <div class="container">
    
    <!-- HEADER SECTION -->
    <header>
      <div class="logo-search">
        <div class="logo">
          <img src="assets/logo.jpg" alt="Logo" class="institute-logo">
        </div>
        <div class="search-wrapper">
          <input type="search" [placeholder]="config.SEARCH_PLACEHOLDER" />
          <i class="fas fa-search"></i>
        </div>
      </div>
      <div class="header-right">
        <button class="btn-request" (click)="goToProfileSetupForm()" style="background-color: #F43F5E;">
            <i class="fas fa-user-edit"></i> <span>Setup Profile</span>
        </button>
      </div>
    </header>

    <!-- DASHBOARD GRID WRAPPER -->
    <div class="dashboard-grid">

      <!-- 1. LEFT SIDEBAR -->
      <aside class="sidebar">
        <nav class="sidebar-nav">
          <!-- Sidebar Links: Only Dashboard and Resume now -->
          <a *ngFor="let link of config.SIDEBAR_LINKS"
             [class.active]="activeTab() === link.id" 
             (click)="activeTab.set(link.id)" 
             [title]="link.label">
            <i [class]="link.icon"></i> <span>{{ link.label }}</span>
          </a>

           <!-- Logout -->
           <a style="color: #ef4444; margin-top: 10px; border-top: 1px solid #f3f4f6; cursor: pointer;" (click)="logout()">
              <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
          </a>
        </nav>
        
        <div class="sidebar-bottom">
          <div class="toggle-switch" [class.active]="darkModeActive()" (click)="darkModeActive.set(!darkModeActive())" title="Toggle Mode">
            <span></span>
          </div>
        </div>
      </aside>

      <!-- 2. CENTER CONTENT -->
      <main class="main-content">
        
        <!-- DASHBOARD VIEW -->
        <ng-container *ngIf="activeTab() === 'dashboard'">
          
          <!-- Trainer Info Card (Displays name from Setup Profile data) -->
          <section class="trainer-info-card attractive-greeting-card">
              <div class="profile-upload-container" (click)="triggerProfileUpload()">
                  <div class="attractive-profile-circle" 
                       [style.backgroundColor]="uploadedProfileImage() ? 'transparent' : '#4338CA'">
                      <img *ngIf="uploadedProfileImage()" [src]="uploadedProfileImage()" alt="Profile" class="uploaded-profile-img">
                      <img *ngIf="!uploadedProfileImage()" [src]="trainerDetails.profileUrl" alt="Profile" class="uploaded-profile-img">
                      
                      <div class="camera-icon-overlay">
                          <i class="fas fa-camera"></i>
                      </div>
                  </div>
                  <input type="file" #fileInput (change)="onProfileImageSelected($event)" accept="image/*" style="display: none;">
              </div>

              <div class="trainer-text" style="text-align: center;">
                  <h2>{{ trainerDetails.name }}</h2>
                  <p class="role">{{ trainerDetails.role }}</p>
                  <p class="role attractive-greeting-text">{{ greeting() }}</p>
              </div>

              <div class="batch-info-badge" style="margin-top: 15px;">
                  <ng-container *ngIf="myBatches().length > 0">
                      <p>{{ myBatches()[0].name }}</p>
                      <span>{{ myBatches()[0].strength }} Students &bull; {{ myBatches()[0].countdown }}</span>
                  </ng-container>
                  <p *ngIf="myBatches().length === 0">No Active Batches</p>
              </div>
          </section>

          <!-- Quick Actions Removed -->
        </ng-container>

        <!-- RESUME VIEW -->
        <ng-container *ngIf="activeTab() === 'resume'">
            <app-generate-ats-resume [isDashboardEmbed]="true"></app-generate-ats-resume>
        </ng-container>

        <!-- Removed Profile Setting View from sidebar, accessible only via Setup Profile logic if needed -->

        <!-- Placeholder for unknown tabs -->
        <ng-container *ngIf="activeTab() !== 'dashboard' && activeTab() !== 'resume'">
            <div class="panel-card" style="height: 100%; justify-content: center; align-items: center; text-align: center; color: #9ca3af; display: flex; flex-direction: column; background: white; border-radius: 20px;">
                <i class="fas fa-tools" style="font-size: 48px; margin-bottom: 20px;"></i>
                <h2>Section Under Development</h2>
                <button class="btn-request" (click)="activeTab.set('dashboard')" style="margin-top: 20px;">Back to Dashboard</button>
            </div>
        </ng-container>

      </main>

      <!-- 3. RIGHT SIDEBAR (Schedule) -->
      <section class="right-schedule-card">
        <div class="current-time-display">
          <p class="current-time-text">Current Time: {{ currentTime() }}</p>
        </div>
        
        <div class="calendar-controls">
          <button (click)="navigateCalendar(-1)">&lt;</button>
          <p>{{ selectedMonthYear() }}</p>
          <button (click)="navigateCalendar(1)">&gt;</button>
        </div>

        <div class="calendar-weekdays">
          <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
        </div>
        <div class="calendar-days">
          <div *ngFor="let day of calendarDays()"
            [class.inactive]="day.disabled"
            [class.active]="day.selected"
            [class.has-event]="day.hasEvent"
            (click)="!day.disabled && onDateSelect(day)">
            {{ day.date }}
          </div>
        </div>

        <div class="schedule-list">
          <h5>Events for {{ selectedScheduleDate() | date:'dd MMM' }}</h5>
          <div *ngIf="scheduleDetails().length === 0" style="font-size: 13px; color: #9ca3af; text-align: center; padding: 20px 0; background: #f9fafb; border-radius: 12px; border: 1px dashed #e5e7eb;">
              No specific events today.
          </div>
          <div class="schedule-section" *ngIf="scheduleDetails().length > 0">
            <div *ngFor="let item of scheduleDetails()" class="schedule-item" [ngClass]="getScheduleTypeClass(item.type)">
              <div class="date">{{ item.dayOfWeekShort }}<br>{{ item.dayOfMonth }}</div>
              <p class="desc">{{ item.desc }}</p>
              <button *ngIf="item.joinButton" class="join-button">JOIN</button>
            </div>
          </div>
        </div>

        <div style="margin-top: auto; padding-top: 20px;">
            <button class="btn-request" style="width: 100%; justify-content: center;" (click)="openLeaveForm()">
                Apply for Leave
            </button>
        </div>
      </section>

    </div>

    <!-- Modals -->
    <div *ngIf="isLeaveFormOpen()" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Apply for Leave</h3>
                <button class="close-button" (click)="closeLeaveForm()">&times;</button>
            </div>
            <div class="form-group">
                <label>Start Date</label>
                <input type="date" [value]="leaveStartDate()" (input)="leaveStartDate.set($any($event.target).value)">
                
                <label>End Date</label>
                <input type="date" [value]="leaveEndDate()" (input)="leaveEndDate.set($any($event.target).value)">
                
                <label>Reason</label>
                <textarea rows="3" [value]="leaveReason()" (input)="leaveReason.set($any($event.target).value)"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" (click)="closeLeaveForm()">Cancel</button>
                <button class="btn-submit" (click)="submitLeave()">Submit Application</button>
            </div>
        </div>
    </div>

  </div>
</body>