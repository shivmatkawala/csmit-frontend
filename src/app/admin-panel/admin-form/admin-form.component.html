<div class="page-container">
    <div class="form-card">
        <div class="form-header">
            <!-- Back Button -->
            <button class="back-btn" (click)="goBack()" title="Go to Admin Panel">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>
            
            <!-- Dynamic Title -->
            <h2 [class.edit-mode-title]="currentAdminId()">{{ formTitle() }}</h2>

            <!-- Toggle Admin List Button -->
            <button class="menu-btn" (click)="toggleAdminList()" title="View All Admins">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </button>
        </div>

        <!-- Template-Driven Form START -->
        <form #adminForm="ngForm" (ngSubmit)="onSubmit(adminForm)" class="admin-form">

            <!-- Name Fields -->
            <div class="form-group-row">
                <div class="form-group">
                    <label for="firstName">First Name</label>
                    <!-- ngModel Binding with required validation -->
                    <input type="text" id="firstName" name="firstName" [(ngModel)]="newAdmin().firstName" required #firstName="ngModel" placeholder="e.g., John">
                    <div *ngIf="firstName.invalid && (firstName.dirty || firstName.touched)" class="error-message">
                        First Name is required.
                    </div>
                </div>
                <div class="form-group">
                    <label for="lastName">Last Name</label>
                     <!-- ngModel Binding with required validation -->
                    <input type="text" id="lastName" name="lastName" [(ngModel)]="newAdmin().lastName" required #lastName="ngModel" placeholder="e.g., Smith">
                    <div *ngIf="lastName.invalid && (lastName.dirty || lastName.touched)" class="error-message">
                        Last Name is required.
                    </div>
                </div>
            </div>

            <!-- Contact Fields -->
            <div class="form-group-row">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <!-- ngModel Binding with required and email validation -->
                    <input type="email" id="email" name="email" [(ngModel)]="newAdmin().email" required email #email="ngModel" placeholder="e.g., john.smith@admin.com">
                    <div *ngIf="email.invalid && (email.dirty || email.touched)" class="error-message">
                        A valid Email address is required.
                    </div>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <!-- ngModel Binding with required and pattern validation -->
                    <input type="tel" id="phone" name="phone" [(ngModel)]="newAdmin().phone" required pattern="[0-9]{10,15}" #phone="ngModel" placeholder="e.g., 9876543210">
                    <div *ngIf="phone.invalid && (phone.dirty || phone.touched)" class="error-message">
                        A 10-15 digit phone number is required.
                    </div>
                </div>
            </div>

            <!-- Profile Image Upload -->
            <div class="form-group image-upload-group">
                <label class="image-label">Profile Image (Optional)</label>
                <div class="image-preview-area">
                    <img [src]="newAdmin().imageUrl" alt="Profile Preview" class="profile-preview" onerror="this.src='https://placehold.co/80x80/673AB7/ffffff?text=A'">
                    
                    <div class="upload-btn-container">
                        <input type="file" id="imageUpload" class="file-input" (change)="handleImageUpload($event)" accept="image/*" #imageInput>
                        <button type="button" class="btn-upload-file" (click)="imageInput.click()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.2 15c.7-1.2 1-2.5.7-3.9-.7-1.4-2-2.3-3.4-2.4-1.6-4-5.2-6.5-9.4-6-4.1.5-7.4 3.2-8.5 7.6-.7 2.8.7 5.7 3.6 6.8 2.6.9 5.3-.2 7.1-2.1"></path><path d="M11 15v3"></path><path d="M8 15h6"></path><path d="M12 11v-4"></path><polyline points="12 4 12 16 8 12"></polyline></svg>
                            {{ newAdmin().imageUrl.includes('placehold.co') ? 'Upload Image' : 'Change' }}
                        </button>
                        <button type="button" class="btn-remove-file" *ngIf="!newAdmin().imageUrl.includes('placehold.co')" (click)="removeImage()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            Remove
                        </button>
                    </div>
                </div>
            </div>

            <!-- Experience Field -->
            <div class="form-group">
                <label for="experienceYears">Years of Experience (Admin Role)</label>
                 <!-- ngModel Binding with required and min validation -->
                <input type="number" id="experienceYears" name="experienceYears" [(ngModel)]="newAdmin().experienceYears" min="0" required #experienceYears="ngModel" placeholder="e.g., 5">
                <div *ngIf="experienceYears.invalid && (experienceYears.dirty || experienceYears.touched)" class="error-message">
                    Experience (Years) is required. Minimum must be 0.
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button type="button" class="btn-cancel" (click)="resetForm(adminForm)">
                    {{ currentAdminId() ? 'Reset Form' : 'Cancel / Reset' }}
                </button>
                <!-- Submit button disabled if form is invalid -->
                <button type="submit" class="btn-submit" [disabled]="adminForm.invalid">
                    {{ currentAdminId() ? 'Save Changes' : 'Create Admin' }}
                </button>
            </div>
        </form>
        <!-- Template-Driven Form END -->
    </div>
</div>

<!-- Admin List Sidebar (Right side pop-up) -->
<div class="admin-list-sidebar" [class.active]="isAdminListVisible()">
    <div class="list-header">
        <h3>All Admins ({{ admins().length }})</h3>
        <button class="close-list-btn" (click)="toggleAdminList()" title="Close List">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
    </div>
    
    <div class="list-content">
        <div *ngIf="admins().length === 0" class="no-data-msg">
            No admins created yet.
        </div>

        <div *ngFor="let admin of admins()" 
             class="admin-item" 
             (click)="toggleAdminActions(admin)"
             [class.selected]="selectedAdminForActions()?.id === admin.id">
            
            <div class="admin-info">
                <img [src]="admin.imageUrl" alt="Profile" class="profile-thumb" onerror="this.src='https://placehold.co/80x80/673AB7/ffffff?text=A'">
                <div class="admin-name">{{ admin.firstName }} {{ admin.lastName }}</div>
            </div>

            <div class="admin-actions" [class.show]="selectedAdminForActions()?.id === admin.id">
                <button class="action-btn edit" (click)="loadAdminForEdit(admin)" title="Edit Admin">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
                </button>
                
                <button class="action-btn delete" (click)="openDeleteConfirm(admin)" title="Delete Admin">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                </button>
            </div>
        </div>
    </div>
    
    <!-- User ID for reference -->
    <div class="auth-id">
        <small>Mock User ID: {{ userId }}</small>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="isDeleteModalVisible()">
    <div class="delete-confirm-card">
        <h3>Permanent Deletion</h3>
        <p>
            Are you sure you want to permanently delete admin <strong>{{ adminToDelete()?.firstName }} {{ adminToDelete()?.lastName }}</strong>? 
            This action cannot be undone.
        </p>
        <div class="confirm-actions">
            <button type="button" class="btn-cancel" (click)="cancelDelete()">Cancel</button>
            <button type="button" class="btn-delete-confirm" (click)="confirmDelete()">Yes, Delete</button>
        </div>
    </div>
</div>
