<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<body>
  <!-- Main container -->
  <div class="container" [class.exam-active-mode]="activePage === 'attend-exam'">
    
    <!-- HEADER SECTION (Hidden during Exam) -->
    <header *ngIf="activePage !== 'attend-exam'">
      <div class="logo-search">
        <div class="logo">
          <img src="assets/logo.jpg" alt="Logo" class="institute-logo">
        </div>
        <div class="search-wrapper">
          <input type="search" placeholder="Search Courses, Assignments..." [formControl]="searchControl" />
          <i class="fas fa-search"></i>
        </div>
      </div>
      <div class="header-right">
        <button class="btn-request" (click)="goToProfileSetupForm()" style="background-color: #F43F5E;">
          <i class="fas fa-user-edit"></i> <span>Setup Profile</span>
        </button>
      </div>
    </header>

    <!-- DASHBOARD GRID WRAPPER (Hidden during Exam) -->
    <div class="dashboard-grid" *ngIf="activePage !== 'attend-exam'">

      <!-- 1. LEFT SIDEBAR -->
      <aside class="sidebar">
        <nav class="sidebar-nav">
          <a [class.active]="activePage === 'dashboard'" (click)="setActivePage('dashboard')">
              <i class="fas fa-home"></i> <span>Home</span>
          </a>
          <a [class.active]="activePage === 'courses'" (click)="setActivePage('courses')">
              <i class="fas fa-book"></i> <span>Courses</span>
          </a>
          <a [class.active]="activePage === 'shorts'" (click)="setActivePage('shorts')" style="color: #ec4899;">
              <i class="fas fa-play-circle" style="font-size: 26px;"></i> <span>Shorts</span>
          </a>
          <a [class.active]="activePage === 'assignments'" (click)="setActivePage('assignments')">
              <i class="fas fa-tasks"></i> <span>Tasks</span>
          </a>
          <a [class.active]="activePage === 'profile-setting'" (click)="setActivePage('profile-setting')">
              <i class="fas fa-user"></i> <span>Profile</span>
          </a>
          <a [class.active]="activePage === 'generate-resume'" (click)="goToResumeView()">
              <i class="fas fa-file-alt"></i> <span>Resume</span>
          </a>

          <!-- NEW: Logout Button -->
          <a (click)="logout()" style="color: #ef4444; margin-top: 10px; border-top: 1px solid #f3f4f6;">
              <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
          </a>
        </nav>
        
        <div class="sidebar-bottom">
          <div class="toggle-switch" id="toggleSwitch" [class.active]="notificationsEnabled" (click)="notificationsEnabled = !notificationsEnabled">
            <span></span>
          </div>
        </div>
      </aside>

      <!-- 2. CENTER CONTENT (Dashboard, Shorts, etc.) -->
      <main class="main-content">
        
        <!-- DASHBOARD HOME -->
        <ng-container *ngIf="activePage === 'dashboard'">
          <section class="trainer-info-card attractive-greeting-card">
              <div class="profile-upload-container" (click)="triggerProfileUpload()">
                  <div class="attractive-profile-circle" 
                       [style.backgroundColor]="uploadedProfileImage ? 'transparent' : '#4338CA'">
                      <img *ngIf="uploadedProfileImage" [src]="uploadedProfileImage" alt="Profile" class="uploaded-profile-img">
                      <span *ngIf="!uploadedProfileImage" class="profile-initial-text">{{ profileInitial }}</span>
                      <div class="camera-icon-overlay">
                          <i class="fas fa-camera"></i>
                      </div>
                  </div>
                  <input type="file" #fileInput (change)="onProfileImageSelected($event)" accept="image/*" style="display: none;">
              </div>

              <h2>{{ studentName }}</h2> 
              <p class="role attractive-greeting-text">{{ greeting }}</p>
              <div class="batch-details">
                  <p>{{ currentDayOfWeek }}, {{ currentDay }} {{ currentMonth }}</p>
              </div>
          </section>

          <section class="stats-cards-container">
              <div *ngFor="let card of quickAccessCards; let i = index" 
                  class="stat-card" 
                  [ngClass]="card.colorClass"
                  (click)="handleQuickCardClick(card.route)">
                <p class="title">{{ card.title }}</p>
                <p class="value" *ngIf="card.route === 'batches'">{{ studentAssignedBatches.length > 0 ? studentAssignedBatches[0].batch_name : 'No Batch' }}</p>
                <p class="value" *ngIf="card.route !== 'batches'">{{ card.value }}</p>
                
                <div class="footer-info">
                  <span>{{ card.subText }}</span>
                  <i [class]="card.icon" [ngStyle]="{'color': i === 0 ? '#4338CA' : i === 1 ? '#F59E0B' : i === 2 ? '#10B981' : '#F43F5E'}"></i>
                </div>
              </div>
          </section>
        </ng-container>

        <!-- SHORTS PAGE -->
        <ng-container *ngIf="activePage === 'shorts'">
            <div class="shorts-wrapper">
                <div class="shorts-container">
                    <div class="short-item" *ngFor="let short of shortsList">
                        <div class="video-container">
                            <iframe 
                                [src]="short.safeUrl" 
                                title="YouTube video player" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                allowfullscreen>
                            </iframe>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>

        <!-- OTHER PAGES -->
        <ng-container *ngIf="activePage === 'profile-setting'">
          <div class="profile-setting-wrapper">
            <app-profile-setting [profileData]="studentProfileData" (goBack)="setActivePage('dashboard')"></app-profile-setting>
          </div>
        </ng-container>
        
        <ng-container *ngIf="activePage === 'generate-resume'">
            <app-generate-ats-resume [isDashboardEmbed]="true"></app-generate-ats-resume>
        </ng-container>

        <ng-container *ngIf="['courses', 'assignments', 'career'].includes(activePage)">
            <div class="other-page-content">
                <i class="fas fa-tools" style="font-size: 48px; color: #cbd5e1; margin-bottom: 20px;"></i>
                <h1>{{ activePage | titlecase }}</h1>
                <p>This section is currently under development.</p>
                <button class="btn-cancel" (click)="setActivePage('dashboard')">Back to Home</button>
            </div>
        </ng-container>
      </main>

      <!-- 3. RIGHT SIDEBAR (Schedule) - Hidden on mobile via CSS, hidden logic handled by grid -->
      <section class="right-schedule-card" *ngIf="activePage === 'dashboard'">
        <div class="current-time-display">
          <p class="current-time-text">Current Time: {{ currentTime }}</p>
        </div>
        <div class="right-schedule-header">
          <h3>My Schedule</h3>
          <button (click)="openExamModal()" style="color: #F59E0B; font-size: 16px;">
              <i class="fas fa-edit"></i> Exams
          </button>
        </div>

        <div class="calendar-controls">
          <button (click)="navigateCalendar(-1)">&lt;</button>
          <p>{{ selectedMonthYear }}</p>
          <button (click)="navigateCalendar(1)">&gt;</button>
        </div>

        <div class="calendar-weekdays">
          <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
        </div>
        <div class="calendar-days">
          <div *ngFor="let day of calendarDays"
            [class.inactive]="day.disabled"
            [class.active]="day.selected"
            (click)="!day.disabled && onDateSelect(day.fullDate)">
            {{ day.date }}
          </div>
        </div>

        <div class="schedule-list">
          <h5>Schedule for {{ selectedScheduleDate | date:'dd MMM' }}</h5>
          <div *ngIf="scheduleDetails.length === 0" class="no-schedule-message">No classes today.</div>
          <div *ngFor="let item of scheduleDetails" class="schedule-section">
            <div class="schedule-item" [ngClass]="item.type + '-item'">
              <div class="date">{{ item.dayOfWeekShort }} <br> {{ item.dayOfMonth }}</div>
              <p class="desc">{{ item.desc }}</p>
            </div>
          </div>
        </div>
      </section>

    </div> <!-- End Dashboard Grid -->

    <!-- FULL SCREEN EXAM CONTAINER (Only visible during exam) -->
    <div class="exam-fullscreen-container" *ngIf="activePage === 'attend-exam' && examToAttend">
         <app-attend-exam 
            [examId]="examToAttend.examId" 
            [examName]="examToAttend.examName" 
            [durationMinutes]="examToAttend.durationMinutes" 
            (examFinished)="onExamFinished($event)">
        </app-attend-exam>
    </div>

    <!-- Modals -->
    <div *ngIf="showBatchModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>My Batches</h3>
                <button class="close-button" (click)="closeBatchModal()">&times;</button>
            </div>
            <div class="modal-body" *ngFor="let batch of selectedBatchDetails">
                <h4>{{ batch.batch_name }}</h4>
                <p>{{ batch.description }}</p>
            </div>
            <div class="modal-footer"><button class="btn-cancel" (click)="closeBatchModal()">Close</button></div>
        </div>
    </div>

    <div *ngIf="showExamModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Exams</h3>
                <button class="close-button" (click)="closeExamModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p *ngIf="upcomingExams.length === 0">No upcoming exams.</p>
                <div *ngFor="let exam of upcomingExams" class="exam-list-item">
                    <div class="exam-info">
                        <strong>{{ exam.examName }}</strong>
                        <span class="exam-meta">{{ exam.durationMinutes }} Mins | {{ exam.totalQuestions }} Qs</span>
                    </div>
                    <button class="btn-submit" (click)="selectedExamId = exam.examId; startExam()">Start</button>
                </div>
            </div>
            <div class="modal-footer"><button class="btn-cancel" (click)="closeExamModal()">Close</button></div>
        </div>
    </div>

    <div *ngIf="message" [class]="'message-box ' + messageType">
      {{ message }}
    </div>
  </div>
</body>